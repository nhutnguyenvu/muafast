var Checkout=Class.create();Checkout.prototype={winErrorPopup:false,saveNextStep:false,initialize:function(a){this.updateAllInfoUrl=a.updateAllInfoUrl;this.saveMethodUrl=a.saveMethod;this.failureUrl=a.failure;this.billingForm=false;this.shippingForm=false;this.syncBillingShipping=false;this.method="";this.payment="";this.loadWaiting=false},ajaxFailure:function(){location.href=this.failureUrl},_disableEnableAll:function(c,a){var d=c.descendants();for(var b in d){d[b].disabled=a}c.disabled=a},setLoadWaiting:function(c,d){if(c){if(this.loadWaiting){this.setLoadWaiting(false)}var b=$(c+"-buttons-container");b.addClassName("disabled");b.setStyle({opacity:0.5});this._disableEnableAll(b,true);Element.show(c+"-please-wait")}else{if(this.loadWaiting){var b=$(this.loadWaiting+"-buttons-container");var a=(d?true:false);if(!a){b.removeClassName("disabled");b.setStyle({opacity:1})}this._disableEnableAll(b,a);Element.hide(this.loadWaiting+"-please-wait")}}this.loadWaiting=c},setMethod:function(){if($("login:guest")&&$("login:guest").checked){this.method="guest";var a=new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"guest"}});Element.hide("register-customer-password")}else{if($("login:register")&&($("login:register").checked||$("login:register").type=="hidden")){this.method="register";var a=new Ajax.Request(this.saveMethodUrl,{method:"post",onFailure:this.ajaxFailure.bind(this),parameters:{method:"register"}});Element.show("register-customer-password")}else{checkout.showErrorMessage(Translator.translate("Please choose to register or to checkout as a guest"));return false}}},setBilling:function(){if(($("billing:use_for_shipping"))&&($("billing:use_for_shipping").checked)){shipping.syncWithBilling()}else{if(($("billing:use_for_shipping"))&&(!$("billing:use_for_shipping").checked)){$("shipping:same_as_billing").checked=false}else{$("shipping:same_as_billing").checked=true}}},showErrorMessage:function(a){if(!this.winErrorPopup){this.winErrorPopup=new OnePageCheckoutPopup({id:"popup-onepagecheckout-error",html:a,title:Translator.translate("Checkout"),width:500})}else{this.winErrorPopup.setContent(a)}this.winErrorPopup.open()},updateAllInfo:function(){payment.saveFormValues();new Ajax.Request(this.updateAllInfoUrl,{asynchronous:false,method:"post",parameters:Form.serialize($("checkoutSteps")),onSuccess:function(transport){if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}}checkout.updateSections(response)}})},updateSections:function(a){if(a.duplicateBillingInfo){shipping.setSameAsBilling(true)}if(a.update_section.length){for(var b=0;b<cnt;b++){$(a.update_section[b].name).update(a.update_section[b].html)}}payment.fillFormValues();payment.initWhatIsCvvListeners()},updateInfo:function(a){var b=Translator.translate("Updating informations, please wait...");$$("div.onepagecheckout")[0].insert('<div id="onepagecheckout-update-info" class="updateInfo">'+b+"</div>");$("review-buttons-container").addClassName("disabled");payment.saveFormValues();new Ajax.Request(a,{asynchronous:true,method:"post",onFailure:checkout.ajaxFailure.bind(checkout),onSuccess:checkout.onUpdateInfo,parameters:Form.serialize($("checkoutSteps"))})},onUpdateInfo:function(transport){var updateInfoBlock=$("onepagecheckout-update-info");updateInfoBlock.parentNode.removeChild(updateInfoBlock);$("review-buttons-container").removeClassName("disabled");if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}}if(response.redirect){location.href=response.redirect;return}if(response.error){checkout.showErrorMessage(response.message);return}if(response.duplicateBillingInfo){shipping.setSameAsBilling(true)}var cnt=response.update_section.length;if(cnt){for(var i=0;i<cnt;i++){$(response.update_section[i].name).update(response.update_section[i].html)}}payment.fillFormValues();payment.initWhatIsCvvListeners();if(response.message){checkout.showErrorMessage(response.message)}}};var Billing=Class.create();Billing.prototype={initialize:function(b,a){this.form=b;this.addressUrl=a;this.onAddressLoad=this.fillForm.bindAsEventListener(this)},setAddress:function(a){if(a){request=new Ajax.Request(this.addressUrl+a,{method:"get",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)})}else{this.fillForm(false)}},newAddress:function(a){if(a){this.resetSelectedAddress();Element.show("billing-new-address-form")}else{Element.hide("billing-new-address-form")}},resetSelectedAddress:function(){var a=$("billing-address-select");if(a){a.value=""}},fillForm:function(transport){var elementValues={};if(transport&&transport.responseText){try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}}else{this.resetSelectedAddress()}arrElements=Form.getElements(this.form);for(var elemIndex in arrElements){if(arrElements[elemIndex].id){var fieldName=arrElements[elemIndex].id.replace(/^billing:/,"");arrElements[elemIndex].value=elementValues[fieldName]?elementValues[fieldName]:"";
if(fieldName=="country_id"&&billingForm){billingForm.elementChildLoad(arrElements[elemIndex])}}}},setUseForShipping:function(a){$("shipping:same_as_billing").checked=a},validateOnly:function(){var a=new Validation(this.form);if(a.validate()){if($("billing:use_for_shipping")&&$("billing:use_for_shipping").checked){$("billing:use_for_shipping").value=1}return true}checkout.saveNextStep=false;return}};var Shipping=Class.create();Shipping.prototype={initialize:function(b,a){this.form=b;this.addressUrl=a;this.onAddressLoad=this.fillForm.bindAsEventListener(this)},setAddress:function(a){if(a){request=new Ajax.Request(this.addressUrl+a,{method:"get",onSuccess:this.onAddressLoad,onFailure:checkout.ajaxFailure.bind(checkout)})}else{this.fillForm(false)}},newAddress:function(a){if(a){this.resetSelectedAddress();Element.show("shipping-new-address-form")}else{Element.hide("shipping-new-address-form")}shipping.setSameAsBilling(false)},resetSelectedAddress:function(){var a=$("shipping-address-select");if(a){a.value=""}},fillForm:function(transport){var elementValues={};if(transport&&transport.responseText){try{elementValues=eval("("+transport.responseText+")")}catch(e){elementValues={}}}else{this.resetSelectedAddress()}arrElements=Form.getElements(this.form);for(var elemIndex in arrElements){if(arrElements[elemIndex].id){var fieldName=arrElements[elemIndex].id.replace(/^shipping:/,"");arrElements[elemIndex].value=elementValues[fieldName]?elementValues[fieldName]:"";if(fieldName=="country_id"&&shippingForm){shippingForm.elementChildLoad(arrElements[elemIndex])}}}},setSameAsBilling:function(a){$("shipping:same_as_billing").checked=a;if(a){this.syncWithBilling()}},syncWithBilling:function(){$("billing-address-select")&&this.newAddress(!$("billing-address-select").value);$("shipping:same_as_billing").checked=true;if(!$("billing-address-select")||!$("billing-address-select").value){arrElements=Form.getElements(this.form);for(var a in arrElements){if(arrElements[a].id){var b=$(arrElements[a].id.replace(/^shipping:/,"billing:"));if(b){arrElements[a].value=b.value}}}shippingRegionUpdater.update();$("shipping:region_id").value=$("billing:region_id").value;$("shipping:region").value=$("billing:region").value}else{$("shipping-address-select").value=$("billing-address-select").value}},setRegionValue:function(){$("shipping:region").value=$("billing:region").value},validateOnly:function(){var a=new Validation(this.form);if(a.validate()){return true}return}};var ShippingMethod=Class.create();ShippingMethod.prototype={initialize:function(a){this.form=a;this.validator=new Validation(this.form)},validate:function(){var a=document.getElementsByName("shipping_method");if(a.length==0){checkout.showErrorMessage(Translator.translate("Your order cannot be completed at this time as there is no shipping methods available for it. Please make necessary changes in your shipping address."));return false}if(!this.validator.validate()){return false}for(var b=0;b<a.length;b++){if(a[b].checked){return true}}checkout.showErrorMessage(Translator.translate("Please specify shipping method."));return false},validateOnly:function(){if(this.validate()){return true}return}};var Payment=Class.create();Payment.prototype={beforeInitFunc:$H({}),afterInitFunc:$H({}),beforeValidateFunc:$H({}),afterValidateFunc:$H({}),data:false,initialize:function(a){this.form=a},addBeforeInitFunction:function(b,a){this.beforeInitFunc.set(b,a)},beforeInit:function(){(this.beforeInitFunc).each(function(a){(a.value)()})},init:function(){this.beforeInit();var b=Form.getElements(this.form);if($(this.form)){$(this.form).observe("submit",function(d){this.save();Event.stop(d)}.bind(this))}var c=null;for(var a=0;a<b.length;a++){if(b[a].name=="payment[method]"){if(b[a].checked){c=b[a].value}}else{b[a].disabled=true}b[a].setAttribute("autocomplete","off")}if(c){this.switchMethod(c)}this.afterInit()},addAfterInitFunction:function(b,a){this.afterInitFunc.set(b,a)},afterInit:function(){(this.afterInitFunc).each(function(a){(a.value)()})},switchMethod:function(a){if(this.currentMethod&&$("payment_form_"+this.currentMethod)){this.changeVisible(this.currentMethod,true)}if($("payment_form_"+a)){this.changeVisible(a,false);$("payment_form_"+a).fire("payment-method:switched",{method_code:a})}else{document.body.fire("payment-method:switched",{method_code:a})}this.currentMethod=a},changeVisible:function(c,b){var a="payment_form_"+c;[a+"_before",a,a+"_after"].each(function(d){element=$(d);if(element){element.style.display=(b)?"none":"";element.select("input","select","textarea").each(function(e){e.disabled=b})}})},addBeforeValidateFunction:function(b,a){this.beforeValidateFunc.set(b,a)},beforeValidate:function(){var b=true;var a=false;(this.beforeValidateFunc).each(function(c){a=true;if((c.value)()==false){b=false}}.bind(this));if(!a){b=false}return b},validate:function(){var a=this.beforeValidate();if(a){return true}var b=document.getElementsByName("payment[method]");if(b.length==0){checkout.showErrorMessage(Translator.translate("Your order cannot be completed at this time as there is no payment methods available for it."));
return false}for(var c=0;c<b.length;c++){if(b[c].checked){return true}}a=this.afterValidate();if(a){return true}checkout.showErrorMessage(Translator.translate("Please specify payment method."));return false},addAfterValidateFunction:function(b,a){this.afterValidateFunc.set(b,a)},afterValidate:function(){var b=true;var a=false;(this.afterValidateFunc).each(function(c){a=true;if((c.value)()==false){b=false}}.bind(this));if(!a){b=false}return b},validateOnly:function(){var a=new Validation(this.form);if(this.validate()&&a.validate()){return true}return},initWhatIsCvvListeners:function(){$$(".cvv-what-is-this").each(function(a){Event.observe(a,"click",toggleToolTip)})},fillFormValues:function(){if(this.data&&this.form){var a=this.form;$H(this.data.toQueryParams()).each(function(c){try{$(a)[c.key].setValue(c.value)}catch(b){}})}},saveFormValues:function(){if(this.form){this.data=Form.serialize(this.form)}}};var Review=Class.create();Review.prototype={initialize:function(c,b,a){this.form=c;this.saveUrl=b;this.successUrl=a;this.onSave=this.nextStep.bindAsEventListener(this);this.onComplete=this.resetLoadWaiting.bindAsEventListener(this)},validateAll:function(){checkout.setBilling();var a=new Validation("discount-coupon-form");a.reset();var a=new Validation(billing.form);a.reset();var a=new Validation(shipping.form);a.reset();var a=new Validation(shippingMethod.form);a.reset();var a=new Validation(payment.form);a.reset();if(!billing.validateOnly()){return}if(!shipping.validateOnly()){return}if(!checkout.saveNextStep){return}if(!shippingMethod.validateOnly()){return}if(!payment.validateOnly()){return}return true},save:function(){if(checkout.loadWaiting!=false){return}checkout.setLoadWaiting("review");checkout.saveNextStep=true;if(this.validateAll()&&checkout.saveNextStep){var a=Form.serialize(this.form);a.save=true;new Ajax.Request(this.saveUrl,{asynchronous:true,method:"post",parameters:a,onComplete:this.onComplete,onSuccess:this.onSave,onFailure:checkout.ajaxFailure.bind(checkout)})}else{checkout.setLoadWaiting(false)}},resetLoadWaiting:function(a){checkout.setLoadWaiting(false,this.isSuccess)},nextStep:function(transport){if(transport&&transport.responseText){try{response=eval("("+transport.responseText+")")}catch(e){response={}}if(response.redirect){location.href=response.redirect;return}if(response.success){this.isSuccess=true;window.location=this.successUrl}else{var msg=response.error_messages;if(typeof(msg)=="object"){msg=msg.join("\n")}if(msg){checkout.showErrorMessage(msg)}}if(response.error){if((typeof response.message)=="string"){checkout.showErrorMessage(response.message)}else{checkout.showErrorMessage(response.message.join("\n"))}}}},isSuccess:false};OnePageCheckoutPopup=Class.create({id:false,title:false,popup:false,popupObj:false,initialize:function(b){this.id=b.id;this.title=b.title;c=$(this.id);if(!c){popupHtml='<div id="'+this.id+'" class="wp-one-page-checkout-popup opc"><div class="section active"><div class="step-title"><h2>'+this.title+'</h2><span id="'+this.id+'_btn_close" class="number"></span></div><div class="step a-item" id="'+this.id+'_content_html">'+b.html+"</div></div></div>";$$("body")[0].insert(popupHtml);var c=$(this.id)}c.style.position="absolute";c.style.display="block";if(typeof b.width!="undefined"){c.style.width=b.width+"px"}if(typeof b.height!="undefined"){c.style.height=b.height+"px"}this.popup=c;this.setPosition();$(this.id+"_btn_close").onclick=function(){this.close()}.bind(this);var a=this.showOverlay();a.onclick=function(){this.close()}.bind(this)},open:function(){var a=this.showOverlay();a.onclick=function(){this.close()}.bind(this);this.setPosition();this.popup.show()},close:function(){this.hideOverlay();this.popup.hide()},setPosition:function(){this.popup.style.display="block";var b=this.popup.offsetWidth/2;var a=this.getClientHeight()/2+this.getScrollY()-170;this.popup.style.left="50%";this.popup.style.marginLeft="-"+b+"px";this.popup.style.top=a+"px"},setContent:function(a){$(this.id+"_content_html").update(a)},showOverlay:function(){var a=$("onepagecheckout-x-overlay");if(a){a.show()}else{a=document.createElement("div");a.id="onepagecheckout-x-overlay";a.className="onepagecheckout-overlay";document.body.appendChild(a)}return a},hideOverlay:function(){var a=$("onepagecheckout-x-overlay");if(a){a.hide()}},getClientHeight:function(){return this.filterResults(window.innerHeight?window.innerHeight:0,document.documentElement?document.documentElement.clientHeight:0,document.body?document.body.clientHeight:0)},filterResults:function(d,b,a){var c=d?d:0;if(b&&(!c||(c>b))){c=b}return a&&(!c||(c>a))?a:c},getScrollY:function(){scrollY=0;if(typeof window.pageYOffset=="number"){scrollY=window.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){scrollY=document.documentElement.scrollTop}else{if(document.body&&document.body.scrollTop){scrollY=document.body.scrollTop}else{if(window.scrollY){scrollY=window.scrollY}}}}return scrollY}});